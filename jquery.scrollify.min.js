/*!
 * jQuery Scrollify
 * Version 1.0.14
 *
 * Requires:
 * - jQuery 1.7 or higher
 *
 * https://github.com/lukehaas/Scrollify
 *
 * Copyright 2016, Luke Haas
 * Permission is hereby granted, free of charge, to any person obtaining a copy of
 * this software and associated documentation files (the "Software"), to deal in
 * the Software without restriction, including without limitation the rights to
 * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
 * the Software, and to permit persons to whom the Software is furnished to do so,
 * subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
 * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
 * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.



 if touchScroll is false - update index

 */
(function(b,a){if(typeof define==="function"&&define.amd){define(["jquery"],function(c){return a(c,b,b.document)})}else{if(typeof module==="object"&&module.exports){module.exports=a(require("jquery"),b,b.document)}else{a(jQuery,b,b.document)}}}(typeof window!=="undefined"?window:this,function(j,o,x,k){var E=[],u=[],s=[],z=[],m=0,c=0,i=1,r=false,l,D,v=j(o),B=j(o),w=B.scrollTop(),t=false,H=false,e=false,g,d,b,h=false,f=[],C=new Date().getTime(),p=true,n=false,A=0,G="onwheel" in x?"wheel":x.onmousewheel!==k?"mousewheel":"DOMMouseScroll",F={wrapper:"window",section:".section",sectionName:"section-name",interstitialSection:"",easing:"easeOutExpo",scrollSpeed:1100,offset:0,scrollbars:true,target:"html,body",standardScrollElements:false,setHeights:true,overflowScroll:true,updateHash:true,touchScroll:true,before:function(){},after:function(){},afterResize:function(){},afterRender:function(){}};function I(K,J,M,L){if(c===K){M=false}if(h===true){return true}if(u[K]){t=false;if(M){F.before(K,s)}i=1;A=E[K];if(p===false&&c>K&&L===false){if(z[K]){i=parseInt(s[K].outerHeight()/B.height());A=parseInt(E[K])+(s[K].outerHeight()-B.height())}}if(F.updateHash&&F.sectionName&&!(p===true&&K===0)){if(history.pushState){try{history.replaceState(null,null,u[K])}catch(N){if(o.console){console.warn("Scrollify warning: Page must be hosted to manipulate the hash value.")}}}else{o.location.hash=u[K]}}if(p){F.afterRender();p=false}c=K;if(J){j(F.target).stop().scrollTop(A);if(M){F.after(K,s)}}else{H=true;if(j().velocity){j(F.target).stop().velocity("scroll",{duration:F.scrollSpeed,easing:F.easing,offset:A,mobileHA:false})}else{j(F.target).stop().animate({scrollTop:A},F.scrollSpeed,F.easing)}if(o.location.hash.length&&F.sectionName&&o.console){try{if(j(o.location.hash).length){console.warn("Scrollify warning: ID matches hash value - this will cause the page to anchor.")}}catch(N){}}j(F.target).promise().done(function(){H=false;p=false;if(M){F.after(K,s)}})}}}function a(K){function M(O){var Q=0;var N=K.slice(Math.max(K.length-O,1));for(var P=0;P<N.length;P++){Q+=N[P]}return Math.ceil(Q/O)}var L=M(10);var J=M(70);if(L>=J){return true}else{return false}}var q=function(K){n=true;j.easing.easeOutExpo=function(Q,R,P,T,S){return(R==S)?P+T:T*(-Math.pow(2,-10*R/S)+1)+P};g={handleMousedown:function(){if(h===true){return true}t=false;e=false},handleMouseup:function(){if(h===true){return true}t=true;if(e){g.calculateNearest(false,true)}},handleScroll:function(){if(h===true){return true}if(l){clearTimeout(l)}l=setTimeout(function(){e=true;if(t===false){return false}t=false;g.calculateNearest(false,true)},200)},calculateNearest:function(Q,U){w=B.scrollTop();var R=1,P=E.length,T=0,S=Math.abs(E[0]-w),V;for(;R<P;R++){V=Math.abs(E[R]-w);if(V<S){S=V;T=R}}if(L()||N()){m=T;I(T,Q,U,false)}},wheelHandler:function(Q){if(h===true){return true}else{if(F.standardScrollElements){if(j(Q.target).is(F.standardScrollElements)||j(Q.target).closest(F.standardScrollElements).length){return true}}}if(!z[m]){Q.preventDefault()}var S=new Date().getTime();Q=Q||o.event;var P=Q.originalEvent.wheelDelta||-Q.originalEvent.deltaY||-Q.originalEvent.detail;var R=Math.max(-1,Math.min(1,P));if(f.length>149){f.shift()}f.push(Math.abs(P));if((S-C)>200){f=[]}C=S;if(H){return false}if(R<0){if(m<E.length-1){if(L()){if(a(f)){Q.preventDefault();m++;H=true;I(m,false,true,false)}else{return false}}}}else{if(R>0){if(m>0){if(N()){if(a(f)){Q.preventDefault();m--;H=true;I(m,false,true,false)}else{return false}}}}}},keyHandler:function(P){if(h===true){return true}if(H===true){return false}if(P.keyCode==38||P.keyCode==33){if(m>0){if(N()){P.preventDefault();m--;I(m,false,true,false)}}}else{if(P.keyCode==40||P.keyCode==34){if(m<E.length-1){if(L()){P.preventDefault();m++;I(m,false,true,false)}}}}},init:function(){if(F.scrollbars){B.on("mousedown",g.handleMousedown);B.on("mouseup",g.handleMouseup);B.on("scroll",g.handleScroll)}else{j("main").css({overflow:"hidden"})}B.on(G,g.wheelHandler);B.on("keydown",g.keyHandler)}};d={touches:{touchstart:{y:-1,x:-1},touchmove:{y:-1,x:-1},touchend:false,direction:"undetermined"},options:{distance:30,timeGap:800,timeStamp:new Date().getTime()},touchHandler:function(P){if(h===true){return true}else{if(F.standardScrollElements){if(j(P.target).is(F.standardScrollElements)||j(P.target).closest(F.standardScrollElements).length){return true}}}var Q;if(typeof P!=="undefined"){if(typeof P.touches!=="undefined"){Q=P.touches[0];switch(P.type){case"touchstart":d.touches.touchstart.y=Q.pageY;d.touches.touchmove.y=-1;d.touches.touchstart.x=Q.pageX;d.touches.touchmove.x=-1;d.options.timeStamp=new Date().getTime();d.touches.touchend=false;case"touchmove":d.touches.touchmove.y=Q.pageY;d.touches.touchmove.x=Q.pageX;if(d.touches.touchstart.y!==d.touches.touchmove.y&&(Math.abs(d.touches.touchstart.y-d.touches.touchmove.y)>Math.abs(d.touches.touchstart.x-d.touches.touchmove.x))){P.preventDefault();d.touches.direction="y";if((d.options.timeStamp+d.options.timeGap)<(new Date().getTime())&&d.touches.touchend==false){d.touches.touchend=true;if(d.touches.touchstart.y>-1){if(Math.abs(d.touches.touchmove.y-d.touches.touchstart.y)>d.options.distance){if(d.touches.touchstart.y<d.touches.touchmove.y){d.up()}else{d.down()}}}}}break;case"touchend":if(d.touches[P.type]===false){d.touches[P.type]=true;if(d.touches.touchstart.y>-1&&d.touches.touchmove.y>-1&&d.touches.direction==="y"){if(Math.abs(d.touches.touchmove.y-d.touches.touchstart.y)>d.options.distance){if(d.touches.touchstart.y<d.touches.touchmove.y){d.up()}else{d.down()}}d.touches.touchstart.y=-1;d.touches.touchstart.x=-1;d.touches.direction="undetermined"}}default:break}}}},down:function(){if(m<E.length-1){if(L()&&m<E.length-1){m++;I(m,false,true,false)}else{if(Math.floor(s[m].height()/B.height())>i){J(parseInt(E[m])+(B.height()*i));i+=1}else{J(parseInt(E[m])+(s[m].outerHeight()-B.height()))}}}},up:function(){if(m>=0){if(N()&&m>0){m--;I(m,false,true,false)}else{if(i>2){i-=1;J(parseInt(E[m])+(B.height()*i))}else{i=1;J(parseInt(E[m]))}}}},init:function(){if(x.addEventListener&&F.touchScroll){var P={passive:false};x.addEventListener("touchstart",d.touchHandler,P);x.addEventListener("touchmove",d.touchHandler,P);x.addEventListener("touchend",d.touchHandler,P)}}};b={refresh:function(Q,P){clearTimeout(D);D=setTimeout(function(){O(true);M(P,false);if(Q){F.afterResize()}},400)},handleUpdate:function(){b.refresh(false,false)},handleResize:function(){b.refresh(true,false)},handleOrientation:function(){b.refresh(true,true)},handleWrapperUpdate:function(){B=j(F.wrapper);w=B.scrollTop()}};F=j.extend(F,K);b.handleWrapperUpdate();O(false);M(false,true);if(true===r){I(m,false,true,true)}else{setTimeout(function(){g.calculateNearest(true,false)},200)}if(E.length){g.init();d.init();v.on("resize",b.handleResize);if(x.addEventListener){o.addEventListener("orientationchange",b.handleOrientation,false)}}function J(P){if(j().velocity){j(F.target).stop().velocity("scroll",{duration:F.scrollSpeed,easing:F.easing,offset:P,mobileHA:false})}else{j(F.target).stop().animate({scrollTop:P},F.scrollSpeed,F.easing)}}function O(Q){if(Q){w=B.scrollTop()}var P=F.section;z=[];if(F.interstitialSection.length){P+=","+F.interstitialSection}if(F.scrollbars===false){F.overflowScroll=false}j(P).each(function(R){var S=j(this);if(F.setHeights){if(S.is(F.interstitialSection)){z[R]=false}else{if((S.css("height","auto").outerHeight()<B.height())||S.css("overflow")==="hidden"){S.css({height:B.height()});z[R]=false}else{S.css({height:S.height()});if(F.overflowScroll){z[R]=true}else{z[R]=false}}}}else{if((S.outerHeight()<B.height())||(F.overflowScroll===false)){z[R]=false}else{z[R]=true}}});if(Q){B.scrollTop(w)}}function M(Q,R){var P=F.section;if(F.interstitialSection.length){P+=","+F.interstitialSection}E=[];u=[];s=[];j(P).each(function(S){var U=j(this);if(S>0){E[S]=parseInt(U.offset().top)+F.offset}else{E[S]=parseInt(U.offset().top)}if(F.sectionName&&U.data(F.sectionName)){u[S]="#"+U.data(F.sectionName).toString().replace(/ /g,"-")}else{if(U.is(F.interstitialSection)===false){u[S]="#"+(S+1)}else{u[S]="#";if(S===j(P).length-1&&S>1){E[S]=E[S-1]+(parseInt(j(j(P)[S-1]).outerHeight())-parseInt(j(F.wrapper).height()))+parseInt(U.outerHeight())}}}s[S]=U;try{if(j(u[S]).length&&o.console){console.warn("Scrollify warning: Section names can't match IDs - this will cause the browser to anchor.")}}catch(T){}if(o.location.hash===u[S]){m=S;r=true}});if(true===Q){I(m,false,false,false)}}function N(){if(!z[m]){return true}w=B.scrollTop();if(w>parseInt(E[m])){return false}else{return true}}function L(){if(!z[m]){return true}w=B.scrollTop();if(w<parseInt(E[m])+(s[m].outerHeight()-B.height())-28){return false}else{return true}}};function y(J,K){var L=u.length;for(;L>=0;L--){if(typeof J==="string"){if(u[L]===J){m=L;I(L,K,true,true)}}else{if(L===J){m=L;I(L,K,true,true)}}}}q.move=function(J){if(J===k){return false}if(J.originalEvent){J=j(this).attr("href")}y(J,false)};q.instantMove=function(J){if(J===k){return false}y(J,true)};q.next=function(){if(m<u.length){m+=1;I(m,false,true,true)}};q.previous=function(){if(m>0){m-=1;I(m,false,true,true)}};q.instantNext=function(){if(m<u.length){m+=1;I(m,true,true,true)}};q.instantPrevious=function(){if(m>0){m-=1;I(m,true,true,true)}};q.destroy=function(){if(!n){return false}if(F.setHeights){j(F.section).each(function(){j(this).css("height","auto")})}B.off("resize",b.handleResize);if(F.scrollbars){B.off("mousedown",g.handleMousedown);B.off("mouseup",g.handleMouseup);B.off("scroll",g.handleScroll)}B.off(G,g.wheelHandler);B.off("keydown",g.keyHandler);if(x.addEventListener&&F.touchScroll){x.removeEventListener("touchstart",d.touchHandler,false);x.removeEventListener("touchmove",d.touchHandler,false);x.removeEventListener("touchend",d.touchHandler,false)}E=[];u=[];s=[];z=[]};q.update=function(){if(!n){return false}b.handleUpdate()};q.current=function(){return s[m]};q.disable=function(){h=true};q.enable=function(){h=false;if(n){g.calculateNearest(false,false)}};q.isDisabled=function(){return h};q.setOptions=function(J){if(!n){return false}if(typeof J==="object"){F=j.extend(F,J);b.handleWrapperUpdate();b.handleUpdate()}else{if(o.console){console.warn("Scrollify warning: setOptions expects an object.")}}};j.scrollify=q;return q}));